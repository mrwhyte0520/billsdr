import{r as m,j as e,D as z}from"./index-CIddALDL.js";import{E as M}from"./jspdf.es.min-CF4tyWO7.js";import"./jspdf.plugin.autotable-BskTgnMR.js";function W(){const[D,y]=m.useState(!1),[h,N]=m.useState(null),[j,w]=m.useState("all"),[S,B]=m.useState("all"),[d,g]=m.useState([{id:1,number:"PO-2024-001",date:"2024-01-15",supplier:"Proveedor Industrial SA",products:[{name:"Tornillos M8x40",quantity:100,price:25,total:2500},{name:"Arandelas Planas",quantity:200,price:5,total:1e3}],subtotal:3500,itbis:630,total:4130,deliveryDate:"2024-01-25",status:"Pendiente",notes:"Entrega urgente requerida"},{id:2,number:"PO-2024-002",date:"2024-01-14",supplier:"Distribuidora Nacional SRL",products:[{name:"Cables Eléctricos 12AWG",quantity:50,price:120,total:6e3},{name:"Interruptores",quantity:25,price:85,total:2125}],subtotal:8125,itbis:1462.5,total:9587.5,deliveryDate:"2024-01-28",status:"Aprobada",notes:"Material para proyecto eléctrico"},{id:3,number:"PO-2024-003",date:"2024-01-13",supplier:"Servicios Técnicos EIRL",products:[{name:"Servicio de Instalación",quantity:1,price:15e3,total:15e3}],subtotal:15e3,itbis:2700,total:17700,deliveryDate:"2024-01-30",status:"Recibida",notes:"Servicio completado satisfactoriamente"}]),[a,x]=m.useState({supplier:"",deliveryDate:"",notes:"",products:[{name:"",quantity:1,price:0}]}),$=["Proveedor Industrial SA","Distribuidora Nacional SRL","Servicios Técnicos EIRL","Materiales Construcción SA"],o=d.filter(t=>{const s=j==="all"||t.status===j,n=S==="all"||t.supplier===S;return s&&n}),b=()=>a.products.reduce((t,s)=>t+s.quantity*s.price,0),f=()=>b()*.18,C=()=>b()+f(),O=t=>{t.preventDefault();const s=b(),n=f(),p=C(),c=a.products.map(r=>({...r,total:r.quantity*r.price}));if(h)g(d.map(r=>r.id===h.id?{...r,supplier:a.supplier,deliveryDate:a.deliveryDate,notes:a.notes,products:c,subtotal:s,itbis:n,total:p}:r));else{const r={id:d.length+1,number:`PO-2024-${String(d.length+1).padStart(3,"0")}`,date:new Date().toISOString().split("T")[0],supplier:a.supplier,products:c,subtotal:s,itbis:n,total:p,deliveryDate:a.deliveryDate,status:"Pendiente",notes:a.notes};g([...d,r])}P(),alert(h?"Orden de compra actualizada exitosamente":"Orden de compra creada exitosamente")},P=()=>{x({supplier:"",deliveryDate:"",notes:"",products:[{name:"",quantity:1,price:0}]}),N(null),y(!1)},A=t=>{N(t),x({supplier:t.supplier,deliveryDate:t.deliveryDate,notes:t.notes,products:t.products}),y(!0)},E=t=>{confirm("¿Aprobar esta orden de compra?")&&(g(d.map(s=>s.id===t?{...s,status:"Aprobada"}:s)),alert("Orden de compra aprobada exitosamente"))},k=t=>{confirm("¿Marcar esta orden como recibida?")&&(g(d.map(s=>s.id===t?{...s,status:"Recibida"}:s)),alert("Orden marcada como recibida"))},T=t=>{confirm("¿Cancelar esta orden de compra?")&&(g(d.map(s=>s.id===t?{...s,status:"Cancelada"}:s)),alert("Orden de compra cancelada"))},R=()=>{x({...a,products:[...a.products,{name:"",quantity:1,price:0}]})},F=t=>{a.products.length>1&&x({...a,products:a.products.filter((s,n)=>n!==t)})},v=(t,s,n)=>{const p=a.products.map((c,r)=>r===t?{...c,[s]:n}:c);x({...a,products:p})},L=()=>{const t=new M;t.setFontSize(20),t.text("Órdenes de Compra",20,20),t.setFontSize(12),t.text(`Fecha de Generación: ${new Date().toLocaleDateString()}`,20,40),t.text(`Total de Órdenes: ${o.length}`,20,50);const s=o.map(i=>[i.number,i.date,i.supplier,`RD$ ${i.total.toLocaleString()}`,i.deliveryDate,i.status]);t.autoTable({head:[["Número","Fecha","Proveedor","Total","Entrega","Estado"]],body:s,startY:70,theme:"striped",headStyles:{fillColor:[59,130,246]},styles:{fontSize:10},columnStyles:{3:{halign:"right"},5:{halign:"center"}}});const n=o.reduce((i,l)=>i+l.total,0),p=o.filter(i=>i.status==="Pendiente").length,c=o.filter(i=>i.status==="Aprobada").length;t.autoTable({body:[["Total en Órdenes:",`RD$ ${n.toLocaleString()}`],["Órdenes Pendientes:",`${p}`],["Órdenes Aprobadas:",`${c}`]],startY:t.lastAutoTable.finalY+20,theme:"plain",styles:{fontStyle:"bold"}});const r=t.getNumberOfPages();for(let i=1;i<=r;i++)t.setPage(i),t.setFontSize(10),t.text(`Página ${i} de ${r}`,t.internal.pageSize.width-50,t.internal.pageSize.height-10),t.text("Sistema Contable - Órdenes de Compra",20,t.internal.pageSize.height-10);t.save(`ordenes-compra-${new Date().toISOString().split("T")[0]}.pdf`)},q=()=>{let t=`Órdenes de Compra

`;t+=`Número,Fecha,Proveedor,Subtotal,ITBIS,Total,Fecha Entrega,Estado,Notas
`,o.forEach(l=>{t+=`${l.number},${l.date},"${l.supplier}",${l.subtotal},${l.itbis},${l.total},${l.deliveryDate},"${l.status}","${l.notes}"
`}),t+=`

Detalle de Productos
`,t+=`Orden,Producto,Cantidad,Precio Unitario,Total
`,o.forEach(l=>{l.products.forEach(u=>{t+=`${l.number},"${u.name}",${u.quantity},${u.price},${u.total}
`})});const s=o.reduce((l,u)=>l+u.total,0),n=o.filter(l=>l.status==="Pendiente").length,p=o.filter(l=>l.status==="Aprobada").length;t+=`
Estadísticas
`,t+=`Total en Órdenes,${s}
`,t+=`Órdenes Pendientes,${n}
`,t+=`Órdenes Aprobadas,${p}
`,t+=`Total Órdenes,${o.length}
`;const c=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),i=URL.createObjectURL(c);r.setAttribute("href",i),r.setAttribute("download",`ordenes-compra-${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},I=t=>{alert(`Imprimiendo orden de compra: ${t.number}`)};return e.jsx(z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Órdenes de Compra"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona órdenes de compra y seguimiento"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:L,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-file-pdf-line mr-2"}),"Exportar PDF"]}),e.jsxs("button",{onClick:q,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-file-excel-line mr-2"}),"Exportar Excel"]}),e.jsxs("button",{onClick:()=>y(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nueva Orden"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-shopping-cart-line text-xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Órdenes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-time-line text-xl text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d.filter(t=>t.status==="Pendiente").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-check-line text-xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aprobadas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d.filter(t=>t.status==="Aprobada").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-xl text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Valor Total"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["RD$ ",d.reduce((t,s)=>t+s.total,0).toLocaleString()]})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),e.jsxs("select",{value:j,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"Pendiente",children:"Pendiente"}),e.jsx("option",{value:"Aprobada",children:"Aprobada"}),e.jsx("option",{value:"Recibida",children:"Recibida"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]})]}),e.jsx("div",{className:"md:col-span-2 flex items-end",children:e.jsx("button",{onClick:()=>w("all"),className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors whitespace-nowrap",children:"Limpiar Filtros"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lista de Órdenes de Compra"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proveedor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrega"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.supplier}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.deliveryDate}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-semibold text-gray-900",children:["RD$ ",t.total.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.status==="Aprobada"?"bg-green-100 text-green-800":t.status==="Pendiente"?"bg-orange-100 text-orange-800":t.status==="Recibida"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>I(t),className:"text-gray-600 hover:text-gray-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-printer-line"})}),e.jsx("button",{onClick:()=>A(t),className:"text-indigo-600 hover:text-indigo-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-edit-line"})}),t.status==="Pendiente"&&e.jsx("button",{onClick:()=>E(t.id),className:"text-green-600 hover:text-green-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-check-line"})}),t.status==="Aprobada"&&e.jsx("button",{onClick:()=>k(t.id),className:"text-blue-600 hover:text-blue-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-inbox-line"})}),(t.status==="Pendiente"||t.status==="Aprobada")&&e.jsx("button",{onClick:()=>T(t.id),className:"text-red-600 hover:text-red-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-close-line"})})]})})]},t.id))})]})})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:h?"Editar Orden de Compra":"Nueva Orden de Compra"})}),e.jsxs("form",{onSubmit:O,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proveedor *"}),e.jsxs("select",{required:!0,value:a.supplier,onChange:t=>x({...a,supplier:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Seleccionar proveedor"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Entrega *"}),e.jsx("input",{type:"date",required:!0,value:a.deliveryDate,onChange:t=>x({...a,deliveryDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"Productos"}),e.jsxs("button",{type:"button",onClick:R,className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-1"}),"Agregar Producto"]})]}),e.jsx("div",{className:"space-y-3",children:a.products.map((t,s)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 p-3 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Nombre del producto",value:t.name,onChange:n=>v(s,"name",n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"number",placeholder:"Cantidad",value:t.quantity,onChange:n=>v(s,"quantity",Math.max(1,Math.floor(parseFloat(n.target.value||"1")))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.01",placeholder:"Precio",value:t.price,onChange:n=>v(s,"price",Math.max(0,parseFloat(n.target.value||"0"))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["RD$ ",(t.quantity*t.price).toLocaleString()]}),a.products.length>1&&e.jsx("button",{type:"button",onClick:()=>F(s),className:"text-red-600 hover:text-red-900 whitespace-nowrap",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]},s))}),e.jsxs("div",{className:"mt-4 text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Subtotal: RD$ ",b().toLocaleString()]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["ITBIS: RD$ ",f().toLocaleString()]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Total: RD$ ",C().toLocaleString()]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 whitespace-nowrap",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 whitespace-nowrap",children:[h?"Actualizar":"Crear"," Orden"]})]})]})]})})]})})}export{W as default};
//# sourceMappingURL=page-DQ61KpLt.js.map
